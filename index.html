<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MostaClean</title>
    <link rel="icon" type="image/jpeg" href="img/leaf.jpg" />
    <link rel="apple-touch-icon" href="img/leaf.jpg" />

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="container nav-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-leaf"></i>
          </div>
          <span class="logo-text"
            >Mosta<span class="green-text">Clean</span></span
          >
        </div>
        <div class="nav-links">
          <a href="#home">Home</a>
          <a href="#about">About</a>
          <a href="#how-it-works">How it Works</a>
          <a href="#map">Live Map</a>
          <a href="#contact">Contact</a>
        </div>
        <button class="launch-app-btn desktop-launch-btn">Launch App</button>
        <button
          id="mobile-menu-toggle"
          class="mobile-menu-toggle"
          type="button"
          aria-label="Open navigation menu"
          aria-controls="mobile-menu"
          aria-expanded="false"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="mobile-menu" class="mobile-menu">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#how-it-works">How it Works</a>
        <a href="#map">Live Map</a>
        <a href="#contact">Contact</a>
        <button type="button" class="launch-app-btn mobile-launch-btn">
          Launch App
        </button>
      </div>
    </nav>

    <section id="home" class="hero hero-gradient">
      <div class="container hero-content">
        <span class="badge">Mostaganem Smart City</span>
        <h1 class="hero-title">
          A Cleaner City, <br /><span class="green-text">Powered by You.</span>
        </h1>
        <p class="hero-subtitle">
          Join the movement to keep Mostaganem beautiful. Monitor smart bins in
          real-time and report waste issues directly to the authorities with a
          single click.
        </p>
        <div class="hero-buttons">
          <a href="#map" class="btn-dark">View Live Map</a>
          <a href="#how-it-works" class="btn-white">Learn More</a>
        </div>
      </div>
    </section>

    <section id="about" class="about">
      <div class="container about-grid">
        <div class="about-text">
          <h2>Revolutionizing Waste Management in Mostaganem</h2>
          <p>
            Mosta Clean is a citizen-driven platform that bridges the gap
            between the community and public services. Using IoT-enabled trash
            bins and community reporting, we ensure that waste is managed
            efficiently and transparently.
          </p>
          <ul class="check-list">
            <li>
              <i class="fas fa-check-circle"></i> Real-time bin monitoring via
              ESP32
            </li>
            <li>
              <i class="fas fa-check-circle"></i> Community-driven complaint
              priority
            </li>
            <li>
              <i class="fas fa-check-circle"></i> Direct data for faster
              collection
            </li>
          </ul>
        </div>
        <div class="about-image-placeholder">
          <img
            id="about-showcase-image-a"
            class="active"
            src="img/about-1.webp"
            alt="showcase"
          />
          <img
            id="about-showcase-image-b"
            src="img/about-2.webp"
            alt="showcase"
          />
        </div>
      </div>
    </section>

    <section id="how-it-works" class="steps">
      <div class="container">
        <div class="section-header">
          <h2>Report an Issue in 3 Steps</h2>
          <p>
            Your reports help the city prioritize the most urgent clean-up
            areas.
          </p>
        </div>
        <div class="steps-grid">
          <div class="step-card">
            <div class="step-image-placeholder">
              <img src="./img/img1.webp" alt="img 1" />
            </div>
            <div class="step-icon">
              <i class="fas fa-camera"></i>
            </div>
            <h3>1. Take a Picture</h3>
            <p>
              Snap a clear photo of the trash pile or full bin to help us assess
              the situation.
            </p>
          </div>
          <div class="step-card">
            <div class="step-image-placeholder">
              <img src="./img/img2.webp" alt="img 2" />
            </div>
            <div class="step-icon">
              <i class="fas fa-list"></i>
            </div>
            <h3>2. Pick Type</h3>
            <p>
              Select the category (Solid waste, Overflowing bin, etc.) and add a
              quick description.
            </p>
          </div>
          <div class="step-card">
            <div class="step-image-placeholder">
              <img src="./img/img3.webp" alt="img 3" />
            </div>
            <div class="step-icon">
              <i class="fas fa-paper-plane"></i>
            </div>
            <h3>3. Send Location</h3>
            <p>
              Your GPS coordinates are automatically tagged. Hit send and watch
              it appear on the map!
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="map" class="map-section">
      <div class="container">
        <div class="section-header">
          <h2>Live Cleanliness Map</h2>
          <p>Real-time status of bins across Mostaganem City.</p>
        </div>
        <div class="map-wrapper-integrated">
          <div class="map-controls">
            <select id="municipality-select" onchange="filterByMunicipality()">
              <option value="all">All Municipalities (الكل)</option>
              <option value="mostaganem">Mostaganem (مستغانم)</option>
              <option value="khayr_eddine">Khayr Eddine (خير الدين)</option>
              <option value="sayada">Sayada (صيادة)</option>
              <option value="ain_boudinar">Ain Boudinar (عين بودينار)</option>
              <option value="ain_tedles">Ain Tedles (عين تادلس)</option>
              <option value="sour">Sour (سور)</option>
              <option value="sidi_belattar">Sidi Belattar (سيدي بلعطار)</option>
              <option value="oued_el_kheir">Oued El Kheir (وادي الخير)</option>
              <option value="bouguirat">Bouguirat (بوقيرات)</option>
              <option value="safsaf">Safsaf (الصفصاف)</option>
              <option value="sirat">Sirat (سيرات)</option>
              <option value="souaflia">Souaflia (السوافلية)</option>
              <option value="sidi_lakhdar">Sidi Lakhdar (سيدي لخضر)</option>
              <option value="hadjadj">Hadjadj (حجاج)</option>
              <option value="benabdelmalek_ramdane">
                Benabdelmalek Ramdane (بن عبد المالك رمضان)
              </option>
              <option value="sidi_ali">Sidi Ali (سيدي علي)</option>
              <option value="ouled_maallah">
                Ouled Maallah (أولاد مع الله)
              </option>
              <option value="tazgait">Tazgait (تزقايت)</option>
              <option value="mesra">Mesra (ماسرة)</option>
              <option value="ain_sidi_cherif">
                Ain Sidi Cherif (عين سيدي شريف)
              </option>
              <option value="mansourah">Mansourah (منصورة)</option>
              <option value="touahria">Touahria (الطواهرية)</option>
              <option value="achaacha">Achaacha (عشعاشة)</option>
              <option value="khadra">Khadra (خضرة)</option>
              <option value="nekmaria">Nekmaria (النكمارية)</option>
              <option value="ouled_boughalem">
                Ouled Boughalem (أولاد بوغالم)
              </option>
              <option value="hassi_mamèche">Hassi Mamèche (حصي ماماش)</option>
              <option value="mazagran">Mazagran (مزغران)</option>
              <option value="stidia">Stidia (ستيديا)</option>
              <option value="ain_nouissy">Ain Nouissy (عين النويصي)</option>
              <option value="fornaka">Fornaka (فرناكة)</option>
              <option value="el_hassiane">El Hassiane (الحسيان)</option>
            </select>
            <div class="map-stats">
              <span class="stats-label">Full Bins:</span>
              <span id="full-bins-count" class="stats-value">0</span>
            </div>
          </div>
          <div id="live-map"></div>
        </div>
      </div>
    </section>

    <section id="contact" class="contact">
      <div class="contact-card">
        <h2>Contact the Team</h2>
        <form class="contact-form">
          <div class="form-row">
            <div class="form-group">
              <label>Name</label>
              <input type="text" placeholder="Your name" />
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" placeholder="Your email" />
            </div>
          </div>
          <div class="form-group">
            <label>Message</label>
            <textarea rows="4" placeholder="How can we help?"></textarea>
          </div>
          <button type="submit" class="submit-btn">Send Message</button>
        </form>
      </div>
    </section>

    <footer class="footer">
      <div class="container footer-strip">
        <div class="footer-left">
          <div class="footer-socials">
            <a href="#" aria-label="Instagram"
              ><i class="fab fa-instagram"></i
            ></a>
            <a href="#" aria-label="Facebook"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" aria-label="LinkedIn"
              ><i class="fab fa-linkedin-in"></i
            ></a>
          </div>
          <p class="footer-copy">Copyright &copy; 2026 Mosta Clean</p>
        </div>
        <div class="footer-brand">
          <div class="logo">
            <div class="logo-icon">
              <i class="fas fa-leaf"></i>
            </div>
            <span class="logo-text"
              >Mosta<span class="green-text">Clean</span></span
            >
          </div>
        </div>
      </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      // Mobile menu functionality
      const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
      const mobileMenu = document.getElementById("mobile-menu");
      if (mobileMenuToggle && mobileMenu) {
        const closeMobileMenu = () => {
          mobileMenu.classList.remove("open");
          mobileMenuToggle.classList.remove("open");
          mobileMenuToggle.setAttribute("aria-expanded", "false");
        };

        mobileMenuToggle.addEventListener("click", () => {
          const isOpen = mobileMenu.classList.toggle("open");
          mobileMenuToggle.classList.toggle("open", isOpen);
          mobileMenuToggle.setAttribute("aria-expanded", String(isOpen));
        });

        mobileMenu.querySelectorAll("a").forEach((mobileLink) => {
          mobileLink.addEventListener("click", () => {
            closeMobileMenu();
          });
        });

        const mobileLaunchBtn = mobileMenu.querySelector(".mobile-launch-btn");
        if (mobileLaunchBtn) {
          mobileLaunchBtn.addEventListener("click", () => {
            closeMobileMenu();
          });
        }

        window.addEventListener("resize", () => {
          if (window.innerWidth >= 768) {
            closeMobileMenu();
          }
        });
      }

      // About section image carousel
      const aboutShowcaseImageA = document.getElementById(
        "about-showcase-image-a",
      );
      const aboutShowcaseImageB = document.getElementById(
        "about-showcase-image-b",
      );
      const aboutShowcaseImages = [
        "img/about-1.webp",
        "img/about-2.webp",
        "img/about-3.webp",
        "img/about-4.webp",
      ];
      const aboutSwapIntervalMs = 4000;

      aboutShowcaseImages.forEach((imageSrc) => {
        const preloadedImage = new Image();
        preloadedImage.src = imageSrc;
      });

      let visibleLayer = aboutShowcaseImageA;
      let hiddenLayer = aboutShowcaseImageB;
      let aboutImageIndex = 0;

      setInterval(() => {
        aboutImageIndex = (aboutImageIndex + 1) % aboutShowcaseImages.length;
        hiddenLayer.src = aboutShowcaseImages[aboutImageIndex];
        hiddenLayer.classList.add("active");
        visibleLayer.classList.remove("active");

        const previousVisible = visibleLayer;
        visibleLayer = hiddenLayer;
        hiddenLayer = previousVisible;
      }, aboutSwapIntervalMs);

      // MAP FUNCTIONALITY
      let bins = [];
      const cityCenters = {
        mostaganem: [35.9331, 0.0897],
        khayr_eddine: [35.9224, 0.1331],
        sayada: [35.9382, 0.1256],
        ain_boudinar: [35.91, 0.1833],
        ain_tedles: [35.939, 0.3],
        sour: [35.8833, 0.3],
        sidi_belattar: [35.9754, 0.2338],
        oued_el_kheir: [35.9083, 0.25],
        bouguirat: [35.8242, 0.2292],
        safsaf: [35.8167, 0.2667],
        sirat: [35.8667, 0.25],
        souaflia: [35.8458, 0.3542],
        sidi_lakhdar: [36.1481, 0.4489],
        hadjadj: [36.1042, 0.3458],
        benabdelmalek_ramdane: [36.1242, 0.2708],
        sidi_ali: [36.1, 0.4167],
        ouled_maallah: [36.1083, 0.5333],
        tazgait: [36.0167, 0.4667],
        mesra: [35.8567, 0.1558],
        ain_sidi_cherif: [35.8167, 0.1333],
        mansourah: [35.8333, 0.0833],
        touahria: [35.875, 0.1833],
        achaacha: [36.25, 0.6333],
        khadra: [36.2333, 0.5833],
        nekmaria: [36.1833, 0.6],
        ouled_boughalem: [36.2667, 0.7],
        hassi_mameche: [35.8833, 0.0667],
        mazagran: [35.8958, 0.0694],
        stidia: [35.8333, -0.0167],
        ain_nouissy: [35.8167, 0.0167],
        fornaka: [35.75, -0.0167],
        el_hassiane: [35.7833, -0.05],
      };

      // Initialize map
      const map = L.map("live-map").setView([35.9331, 0.0897], 11);
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
        {
          attribution: "&copy; OpenStreetMap contributors &copy; CARTO",
        },
      ).addTo(map);

      // Generate initial bin data
      function generateInitialData() {
        const municipalities = Object.keys(cityCenters);
        let idCounter = 1;

        municipalities.forEach((mun) => {
          const center = cityCenters[mun];
          for (let i = 0; i < 7; i++) {
            const randomLat = center[0] + (Math.random() - 0.5) * 0.015;
            const randomLng = center[1] + (Math.random() - 0.5) * 0.015;
            const isFull = Math.random() > 0.7;

            bins.push({
              id: idCounter++,
              municipality: mun,
              name: `Bin ${mun.replace("_", " ")} #${i + 1}`,
              lat: randomLat,
              lng: randomLng,
              isFull: isFull,
              date: isFull ? "2026-02-11" : "",
              time: isFull
                ? `${String(Math.floor(Math.random() * 24)).padStart(2, "0")}:${String(Math.floor(Math.random() * 60)).padStart(2, "0")}`
                : "",
            });
          }
        });
      }

      // Draw markers on map
      function drawMarkers(dataToDraw) {
        map.eachLayer((layer) => {
          if (layer instanceof L.Marker) map.removeLayer(layer);
        });

        dataToDraw.forEach((bin) => {
          const pinColor = bin.isFull ? "#f56565" : "#48bb78";

          const icon = L.divIcon({
            className: "custom-map-marker",
            html: `<div class="map-pin" style="background-color: ${pinColor};"></div>`,
            iconSize: [24, 24],
            iconAnchor: [12, 24],
          });

          const marker = L.marker([bin.lat, bin.lng], { icon: icon }).addTo(
            map,
          );

          let googleMapsUrl = `https://www.google.com/maps?q=${bin.lat},${bin.lng}`;

          let popupHtml = `
            <div style="min-width:180px; font-family: Inter, sans-serif;">
              <h4 style="margin: 0 0 10px 0; color: #111827; font-size: 14px; font-weight: 700; border-bottom: 2px solid #16a34a; padding-bottom: 6px;">${bin.name}</h4>
              
              ${
                bin.isFull
                  ? `
                <p style="font-size:12px; margin: 5px 0; color: #4b5563;"><strong>Date:</strong> ${bin.date}</p>
                <p style="font-size:12px; margin: 5px 0 10px 0; color: #4b5563;"><strong>Time:</strong> ${bin.time}</p>
                
                <a href="${googleMapsUrl}" target="_blank" 
                   style="display:block; text-align:center; background:#16a34a; color:white; padding:8px; border-radius:8px; text-decoration:none; font-size:12px; font-weight: 600; margin-bottom:8px;">
                   📍 Navigate to Bin
                </a>

                <button onclick="markAsEmpty(${bin.id})" 
                        style="width: 100%; background:#111827; color:white; border:none; padding:8px; border-radius:8px; font-size:12px; font-weight: 600; cursor:pointer;">
                  Mark as Emptied ✅
                </button>
              `
                  : `<p style="color:#16a34a; font-size:13px; font-weight: 600; margin: 10px 0;">✓ Bin is empty</p>`
              }
            </div>
          `;

          marker.bindPopup(popupHtml);
        });

        updateFullBinsCount();
      }

      // Update full bins counter
      function updateFullBinsCount() {
        const fullBins = bins.filter((bin) => bin.isFull).length;
        const countElement = document.getElementById("full-bins-count");
        if (countElement) countElement.innerText = fullBins;
      }

      // Filter by municipality
      function filterByMunicipality() {
        const selected = document.getElementById("municipality-select").value;

        if (selected === "all") {
          map.flyTo([35.9331, 0.0897], 11);
          drawMarkers(bins);
        } else if (cityCenters[selected]) {
          map.flyTo(cityCenters[selected], 14);
          const filteredBins = bins.filter((b) => b.municipality === selected);
          drawMarkers(filteredBins);
        }
      }

      // Mark bin as empty
      window.markAsEmpty = function (id) {
        const bin = bins.find((b) => b.id === id);
        if (bin) {
          bin.isFull = false;
          filterByMunicipality();
        }
      };

      // Initialize the map
      generateInitialData();
      drawMarkers(bins);

      setTimeout(function () {
        map.invalidateSize();
      }, 400);

      window.addEventListener("resize", () => {
        map.invalidateSize();
      });
    </script>
  </body>
</html>
